<!DOCTYPE html>
<html>
<head>
    <title>Urban Sim: Reboot</title>
    <style>
        :root { --neon: #00ff88; --bg: #1a1a2e; }
        body { margin: 0; overflow: hidden; background: var(--bg); font-family: 'Segoe UI', sans-serif; }
        
        /* SLEEK SIMS UI */
        #gui { position: absolute; top: 20px; left: 20px; color: white; background: rgba(26, 26, 46, 0.9); 
               padding: 20px; border-radius: 15px; border-left: 5px solid var(--neon); width: 220px;
               box-shadow: 0 10px 30px rgba(0,0,0,0.5); pointer-events: none; }
        
        #shop { position: absolute; top: 20px; right: 20px; width: 200px; }
        .btn { background: #16213e; color: white; border: 1px solid var(--neon); padding: 10px; 
               margin-bottom: 10px; border-radius: 8px; cursor: pointer; pointer-events: auto;
               transition: 0.2s; width: 100%; text-align: left; }
        .btn:hover { background: var(--neon); color: black; }
        .btn:disabled { opacity: 0.3; cursor: not-allowed; }

        #money-display { font-size: 32px; font-weight: bold; color: var(--neon); }
    </style>
</head>
<body>

    <div id="gui">
        <div id="money-display">§ 0</div>
        <div>CITY STATUS: <span id="rank">Newbie</span></div>
        <div style="margin-top:10px; font-size: 12px; opacity: 0.7;">Click Sim to Hustle<br>Click Ground to Move</div>
    </div>

    <div id="shop">
        <button class="btn" onclick="buyHustler()">Buy Hustler (§50)<br><small>+§1 / sec</small></button>
        <button class="btn" onclick="buySpeed()">Move Faster (§100)<br><small>Speed Boost</small></button>
    </div>

    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } }
    </script>

    <script type="module">
        import * as THREE from 'three';

        // --- ENGINE SETUP ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x0f3460);
        const camera = new THREE.OrthographicCamera(window.innerWidth / -60, window.innerWidth / 60, window.innerHeight / 60, window.innerHeight / -60, 1, 1000);
        camera.position.set(20, 20, 20);
        camera.lookAt(0, 0, 0);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.body.appendChild(renderer.domElement);

        // --- LIGHTS ---
        const ambient = new THREE.AmbientLight(0xffffff, 0.8);
        scene.add(ambient);
        const sun = new THREE.DirectionalLight(0xffffff, 1.2);
        sun.position.set(5, 10, 5);
        sun.castShadow = true;
        scene.add(sun);

        // --- WORLD ---
        const grid = new THREE.GridHelper(40, 40, 0x00ff88, 0x16213e);
        scene.add(grid);

        const street = new THREE.Mesh(new THREE.PlaneGeometry(100, 100), new THREE.MeshStandardMaterial({ color: 0x1a1a2e }));
        street.rotation.x = -Math.PI / 2;
        street.receiveShadow = true;
        scene.add(street);

        // --- PLAYER / SIM ---
        const simGroup = new THREE.Group();
        const body = new THREE.Mesh(new THREE.CapsuleGeometry(0.4, 0.8, 4, 8), new THREE.MeshStandardMaterial({ color: 0x00ff88 }));
        body.position.y = 0.8;
        body.castShadow = true;
        simGroup.add(body);

        // The Plumbob
        const plumbob = new THREE.Mesh(new THREE.OctahedronGeometry(0.3, 0), new THREE.MeshStandardMaterial({ color: 0x00ff88, emissive: 0x00ff88 }));
        plumbob.position.y = 2.4;
        simGroup.add(plumbob);
        scene.add(simGroup);

        // --- GAME LOGIC ---
        let state = { money: 0, speed: 0.1, autoIncome: 0 };
        let targetPos = new THREE.Vector3(0, 0, 0);
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();

        window.buyHustler = () => {
            if (state.money >= 50) {
                state.money -= 50;
                state.autoIncome += 1;
                updateUI();
                spawnBuilding();
            }
        };

        window.buySpeed = () => {
            if (state.money >= 100) {
                state.money -= 100;
                state.speed += 0.05;
                updateUI();
            }
        };

        function spawnBuilding() {
            const h = Math.random() * 5 + 2;
            const b = new THREE.Mesh(new THREE.BoxGeometry(2, h, 2), new THREE.MeshStandardMaterial({ color: 0x16213e }));
            b.position.set(Math.random() * 30 - 15, h/2, Math.random() * 30 - 15);
            b.castShadow = true;
            scene.add(b);
        }

        window.addEventListener('mousedown', (e) => {
            mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
            raycaster.setFromCamera(mouse, camera);
            const hits = raycaster.intersectObjects([street, body]);

            if (hits.length > 0) {
                if (hits[0].object === body) {
                    state.money += 10;
                    plumbob.scale.set(1.5, 1.5, 1.5);
                } else {
                    targetPos.copy(hits[0].point);
                }
                updateUI();
            }
        });

        function updateUI() {
            document.getElementById('money-display').innerText = "§ " + state.money;
            if (state.money > 500) document.getElementById('rank').innerText = "Entrepreneur";
        }

        // --- LOOP ---
        setInterval(() => {
            state.money += state.autoIncome;
            updateUI();
        }, 1000);

        function animate() {
            requestAnimationFrame(animate);
            simGroup.position.lerp(new THREE.Vector3(targetPos.x, 0, targetPos.z), state.speed);
            plumbob.rotation.y += 0.03;
            plumbob.scale.lerp(new THREE.Vector3(1,1,1), 0.1);
            renderer.render(scene, camera);
        }
        animate();

        window.addEventListener('resize', () => {
            const aspect = window.innerWidth / window.innerHeight;
            camera.left = -aspect * 10; camera.right = aspect * 10;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
