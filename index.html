<!DOCTYPE html>
<html>
<head>
    <title>ZENITH HORIZON: SPACE TYCOON</title>
    <style>
        :root { --neon: #00f2ff; --money: #00ff88; --glass: rgba(0, 10, 20, 0.85); }
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Orbitron', sans-serif; color: white; cursor: crosshair; }
        
        #hud { position: absolute; top: 20px; left: 20px; display: flex; flex-direction: column; gap: 10px; pointer-events: none; }
        .glass { background: var(--glass); padding: 20px; border-left: 4px solid var(--neon); backdrop-filter: blur(15px); border: 1px solid rgba(0,242,255,0.15); }
        
        #money-val { font-size: 38px; color: var(--money); font-weight: 900; }
        #rank { font-size: 11px; letter-spacing: 3px; color: var(--neon); margin-bottom: 5px; }

        .price-tag { position: absolute; color: white; background: var(--glass); padding: 12px 18px; 
                     border: 1px solid var(--neon); font-size: 10px; text-align: center; pointer-events: none; 
                     transform: translate(-50%, -50%); border-radius: 4px; box-shadow: 0 0 15px rgba(0,242,255,0.2); }
        
        #bottom-bar { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); font-size: 10px; opacity: 0.5; letter-spacing: 2px; }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&display=swap" rel="stylesheet">
</head>
<body>

    <div id="hud">
        <div class="glass">
            <div id="rank">RANK: GALACTIC COMMANDER</div>
            <div id="money-val">§ 5,000</div>
            <div id="income-val" style="font-size: 12px; color: var(--neon); opacity: 0.8;">NET: §0/SEC</div>
        </div>
    </div>

    <div id="bottom-bar">SYSTEMS NOMINAL | CLICK CORE FOR §250 | SPACE TO JUMP</div>
    <div id="labels-container"></div>

    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } }
    </script>

    <script type="module">
        import * as THREE from 'three';

        // --- CORE ENGINE ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 5000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.toneMapping = THREE.ReinhardToneMapping;
        document.body.appendChild(renderer.domElement);

        // --- DYNAMIC SUN (DAY/NIGHT) ---
        const sunPivot = new THREE.Group();
        scene.add(sunPivot);
        const sun = new THREE.DirectionalLight(0xffffff, 2);
        sun.position.set(0, 300, 500);
        sunPivot.add(sun);
        const amb = new THREE.AmbientLight(0x4040ff, 0.3);
        scene.add(amb);

        // --- ENVIRONMENT ---
        const starGeo = new THREE.BufferGeometry();
        const starPos = new Float32Array(50000 * 3);
        for(let i=0; i<50000*3; i++) starPos[i] = (Math.random()-0.5)*4000;
        starGeo.setAttribute('position', new THREE.BufferAttribute(starPos, 3));
        scene.add(new THREE.Points(starGeo, new THREE.PointsMaterial({color: 0xffffff, size: 0.7})));

        const floor = new THREE.Mesh(new THREE.CylinderGeometry(800, 800, 2, 64), new THREE.MeshStandardMaterial({color: 0x050510, roughness: 0.8}));
        floor.position.y = -1;
        scene.add(floor);

        // --- PLAYER & ENTITIES ---
        const player = new THREE.Group();
        player.add(new THREE.Mesh(new THREE.CapsuleGeometry(0.5, 1.2), new THREE.MeshStandardMaterial({color: 0xffffff})));
        scene.add(player);

        const bot = new THREE.Mesh(new THREE.OctahedronGeometry(0.4), new THREE.MeshStandardMaterial({color: 0xffcc00, emissive: 0xffcc00, emissiveIntensity: 2}));
        bot.visible = false;
        scene.add(bot);

        // --- STATE & TYCOON ---
        let money = 5000, income = 0, vY = 0, isJumping = false;
        const keys = {}, buyPads = [], ships = [], asteroids = [];
        const labelContainer = document.getElementById('labels-container');

        function createPad(x, z, cost, name, color, onBuy) {
            const pad = new THREE.Group();
            pad.add(new THREE.Mesh(new THREE.TorusGeometry(4.5, 0.1, 16, 64), new THREE.MeshBasicMaterial({color: color})));
            pad.rotation.x = Math.PI/2;
            pad.position.set(x, 0.1, z);
            const div = document.createElement('div');
            div.className = 'price-tag';
            div.style.borderColor = `#${color.toString(16)}`;
            div.innerHTML = `<b>${name}</b><br>§${cost.toLocaleString()}`;
            labelContainer.appendChild(div);
            pad.userData = { cost, active: true, onBuy, div };
            scene.add(pad);
            buyPads.push(pad);
        }

        // --- THE "ZENITH" PROGRESSION ---
        createPad(50, 0, 5000, "SENTINEL 2.0", 0xffcc00, () => {
            bot.visible = true;
            createPad(0, -60, 25000, "STAR-LIFT TOWER", 0x00f2ff, () => {
                income += 5000;
                const tower = new THREE.Mesh(new THREE.CylinderGeometry(2, 5, 250), new THREE.MeshStandardMaterial({color: 0x111111}));
                tower.position.set(0, 125, -100);
                scene.add(tower);
                // Add beams
                const beam = new THREE.Mesh(new THREE.CylinderGeometry(0.5, 0.5, 500), new THREE.MeshBasicMaterial({color: 0x00f2ff, transparent: true, opacity: 0.2}));
                beam.position.set(0, 0, -100);
                scene.add(beam);
            });
        });

        // --- SYSTEMS ---
        function spawnAsteroid() {
            const ast = new THREE.Mesh(new THREE.IcosahedronGeometry(2.5), new THREE.MeshStandardMaterial({color: 0xff4400, emissive: 0xff0000}));
            ast.position.set((Math.random()-0.5)*500, 60, (Math.random()-0.5)*500);
            scene.add(ast);
            asteroids.push(ast);
        }
        setInterval(spawnAsteroid, 3000);

        window.addEventListener('keydown', e => keys[e.code] = true);
        window.addEventListener('keyup', e => keys[e.code] = false);

        function animate() {
            requestAnimationFrame(animate);
            
            // Movement Logic
            const speed = 0.65;
            if(keys['KeyW']) player.translateZ(speed); if(keys['KeyS']) player.translateZ(-speed);
            if(keys['KeyA']) player.rotation.y += 0.05; if(keys['KeyD']) player.rotation.y -= 0.05;
            
            if(keys['Space'] && !isJumping) { vY = 0.55; isJumping = true; }
            vY -= 0.025; player.position.y += vY;
            if(player.position.y <= 0) { player.position.y = 0; vY = 0; isJumping = false; }

            // Day/Night Cycle
            sunPivot.rotation.x += 0.001;

            // Sentinel AI
            if(bot.visible) {
                bot.position.lerp(player.position.clone().add(new THREE.Vector3(4, 5, -4)), 0.1);
                bot.rotation.z += 0.1;
                asteroids.forEach((ast, i) => {
                    if(bot.position.distanceTo(ast.position) < 50) {
                        money += 2500; scene.remove(ast); asteroids.splice(i, 1);
                    }
                });
            }

            // HUD & Economy
            money += income/60;
            document.getElementById('money-val').innerText = "§ " + Math.floor(money).toLocaleString();
            document.getElementById('income-val').innerText = `NET: §${Math.floor(income).toLocaleString()}/SEC`;

            asteroids.forEach(ast => { ast.position.y -= 0.2; ast.rotation.y += 0.02; });

            buyPads.forEach(pad => {
                if(!pad.userData.active) return;
                const v = pad.position.clone().add(new THREE.Vector3(0, 6, 0)).project(camera);
                pad.userData.div.style.left = (v.x * 0.5 + 0.5) * window.innerWidth + 'px';
                pad.userData.div.style.top = (-v.y * 0.5 + 0.5) * window.innerHeight + 'px';
                if(player.position.distanceTo(pad.position) < 4.5 && money >= pad.userData.cost) {
                    money -= pad.userData.cost; pad.userData.active = false; pad.userData.div.remove();
                    scene.remove(pad); pad.userData.onBuy();
                }
            });

            // Camera Smoothing
            const camTarget = new THREE.Vector3(0, 18, -35).applyMatrix4(player.matrixWorld);
            camera.position.lerp(camTarget, 0.12);
            camera.lookAt(player.position.clone().add(new THREE.Vector3(0, 3, 0)));
            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>
